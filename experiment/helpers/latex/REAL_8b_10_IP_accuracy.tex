\documentclass[crop,tikz]{standalone}% 'crop' is the default for v1.0, before it was 'preview'
\usepackage{pgfplots}
\usepackage{pgfplotstable}
\usepgfplotslibrary{groupplots}

\input{setup.tex}

\begin{document}
\usepgfplotslibrary{fillbetween}
\pgfplotstableread[col sep=comma]{quantize-extra/MNIST-10/quantized_layer_8_bits.csv}\iplane
\pgfplotstableread[col sep=comma]{quantize-extra/MNIST-10/accuracy.csv}\tabacc
\pgfplotsset{
acc axis/.style={
	xmin=0,xmax=3000,
  xtick={0,1000,2000,3000},
  height=0.7\linewidth,
  width=0.7\linewidth,
	ymin=0.8,ymax=1,
	legend style={ at={(0.8,0.2)}, anchor=south east},
	xlabel={Epoch},
	ylabel={Accuracy},
},
}

\begin{tikzpicture}
	\begin{groupplot}[group style={group size= 2 by 1, horizontal sep=2cm,vertical sep=0cm}]
		\nextgroupplot[IB axis MNIST]
			\addplot[IB plot REAL] table[x=x,y=y]{\iplane};
	  \nextgroupplot[acc axis]
		% Legend
		\addlegendimage{no markers,colRelu}
		\addlegendentry{Train}
		\addlegendimage{no markers,dashed,colRelu}
		\addlegendentry{Test}

		% MNIST train
		\addplot[color=colRelu] table[x=epoch,y=train_mean]{\tabacc};
		\addplot[name path=up, color=colRelu!40] table[x=epoch,y=train_up]{\tabacc};
		\addplot[name path=lw, color=colRelu!40] table[x=epoch,y=train_lw]{\tabacc};
		\addplot[colRelu!40,fill opacity=0.4] fill between[of=up and lw];
		
		% MNIST test
		\addplot[color=colRelu,dashed] table[x=epoch,y=test_mean]{\tabacc};
		\addplot[name path=up2, color=colRelu!40] table[x=epoch,y=test_up]{\tabacc};
		\addplot[name path=lw2, color=colRelu!40] table[x=epoch,y=test_lw]{\tabacc};
		\addplot[colRelu!40,fill opacity=0.4] fill between[of=up2 and lw2];
	\end{groupplot}
\end{tikzpicture}

\end{document}
