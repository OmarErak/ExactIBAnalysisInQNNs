\documentclass[crop,tikz]{standalone}% 'crop' is the default for v1.0, before it was 'preview'
\usepackage{pgfplots}
\usepackage{pgfplotstable}
\usepgfplotslibrary{groupplots}

\input{setup.tex}

\usepgfplotslibrary{fillbetween}
\begin{document}
\pgfplotstableread[col sep=comma]{accuracy/accuracy_binning.csv}\tabacc
\pgfplotstableread[col sep=comma]{accuracy/accuracy_8bit.csv}\tabaccQ

\pgfplotsset{
compat=1.16,
acc axis/.style={
	xmin=0,xmax=8000,
	ymin=0.8,ymax=1,
	legend style={ at={(0.9,0.1)}, anchor=south east },
	xlabel={Epoch},
	ylabel={Accuracy},
},
}
\begin{tikzpicture}
\begin{groupplot}[group style={group size= 2 by 1, horizontal sep=2cm,vertical sep=0cm}]
	\nextgroupplot[acc axis,title=Standard,
	legend style={at={(2.85,0.33)}},
	]
		% Legend
		\addlegendimage{no markers,colTanh}
		\addlegendentry{\tanh\ (train)}
		\addlegendimage{no markers,dashed,colTanh}
		\addlegendentry{\tanh\ (test)}
		\addlegendimage{no markers,colRelu}
		\addlegendentry{\relu\ (train)}
		\addlegendimage{no markers,dashed,colRelu}
		\addlegendentry{\relu\ (test)}
		
		% Tanh train
		\addplot[color=colTanh] table[x=epoch,y=tanh_train_mean]{\tabacc};
		\addplot[name path=tanh_up, color=colTanh!40] table[x=epoch,y=tanh_train_up]{\tabacc};
		\addplot[name path=tanh_lw, color=colTanh!40] table[x=epoch,y=tanh_train_lw]{\tabacc};
		\addplot[colTanh!40,fill opacity=0.4] fill between[of=tanh_up and tanh_lw];

		% Tanh test
		\addplot[color=colTanh,dashed] table[x=epoch,y=tanh_test_mean]{\tabacc};
		\addplot[name path=tanh_up2, color=colTanh!40] table[x=epoch,y=tanh_test_up]{\tabacc};
		\addplot[name path=tanh_lw2, color=colTanh!40] table[x=epoch,y=tanh_test_lw]{\tabacc};
		\addplot[colTanh!40,fill opacity=0.4] fill between[of=tanh_up2 and tanh_lw2];
		
		% Relu train
		\addplot[color=colRelu] table[x=epoch,y=relu_train_mean]{\tabacc};
		\addplot[name path=relu_up, color=colRelu!40] table[x=epoch,y=relu_train_up]{\tabacc};
		\addplot[name path=relu_lw, color=colRelu!40] table[x=epoch,y=relu_train_lw]{\tabacc};
		\addplot[colRelu!40,fill opacity=0.4] fill between[of=relu_up and relu_lw];
		
		% Relu test
		\addplot[color=colRelu,dashed] table[x=epoch,y=relu_test_mean]{\tabacc};
		\addplot[name path=relu_up2, color=colRelu!40] table[x=epoch,y=relu_test_up]{\tabacc};
		\addplot[name path=relu_lw2, color=colRelu!40] table[x=epoch,y=relu_test_lw]{\tabacc};
		\addplot[colRelu!40,fill opacity=0.4] fill between[of=relu_up2 and relu_lw2];
	\nextgroupplot[acc axis,title=Quantized]
		% Tanh train
		\addplot[color=colTanh] table[x=epoch,y=tanh_train_mean]{\tabaccQ};
		\addplot[name path=tanh_up, color=colTanh!40] table[x=epoch,y=tanh_train_up]{\tabaccQ};
		\addplot[name path=tanh_lw, color=colTanh!40] table[x=epoch,y=tanh_train_lw]{\tabaccQ};
		\addplot[colTanh!40,fill opacity=0.4] fill between[of=tanh_up and tanh_lw];
		
		% Tanh test
		\addplot[color=colTanh,dashed] table[x=epoch,y=tanh_test_mean]{\tabaccQ};
		\addplot[name path=tanh_up2, color=colTanh!40] table[x=epoch,y=tanh_test_up]{\tabaccQ};
		\addplot[name path=tanh_lw2, color=colTanh!40] table[x=epoch,y=tanh_test_lw]{\tabaccQ};
		\addplot[colTanh!40,fill opacity=0.4] fill between[of=tanh_up2 and tanh_lw2];

		% Relu train
		\addplot[color=colRelu] table[x=epoch,y=relu_train_mean]{\tabaccQ};
		\addplot[name path=relu_up, color=colRelu!40] table[x=epoch,y=relu_train_up]{\tabaccQ};
		\addplot[name path=relu_lw, color=colRelu!40] table[x=epoch,y=relu_train_lw]{\tabaccQ};
		\addplot[colRelu!40,fill opacity=0.4] fill between[of=relu_up and relu_lw];

		% Relu test
		\addplot[color=colRelu,dashed] table[x=epoch,y=relu_test_mean]{\tabaccQ};
		\addplot[name path=relu_up2, color=colRelu!40] table[x=epoch,y=relu_test_up]{\tabaccQ};
		\addplot[name path=relu_lw2, color=colRelu!40] table[x=epoch,y=relu_test_lw]{\tabaccQ};
		\addplot[colRelu!40,fill opacity=0.4] fill between[of=relu_up2 and relu_lw2];
	
\end{groupplot}
\end{tikzpicture}
\end{document}

